= selected_menu(:menu_news)
= section_title('Centro De Noticias')

%section.content.col-lg-9.col-md-9
  .doc-container
    %article
      %h2.entry-title
        = @news.title
      .entry-date
        %span= @news.published_date
      .entry-content
        = @news.content.html_safe
      %ul.entry-meta
        %li.tags
          Temas:
          - @news.topics.each do |topic|
            = link_to topic.name, noticias_path(topic_id: topic.id), class: [:label]
        %li.comments
          %a{:href => "#comments"} #{@news.annotations_count} Comentarios

    .sidebar-doc  
      - if current_user
        %h3 Califica esta noticia:
        %div{:id => "#{@rate}_#{@news.id}", :class => :rate_news}
      %br/
      %h3.actors-title Califica su actuacion:
      %ul.actors-rate-list
        - @news.news_actors.each do |actor|
          %li
            .actor-image
              = image_tag actor.avatar_photo
            .actor-name
              = actor.name
              - if current_user
                %div{:id => "#{actor.ratings.average(:rate)}_#{actor.id}", :class => :rate_actor}
  
  - if @news.facebook_comment_enable?
    #comments.row
      <div class="fb-comments" data-href="#{noticia_url(@news)}" data-colorscheme="light" data-numposts="5" data-width="922"></div>
      <div id="fb-root"></div>
      <script>(function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s); js.id = id;
      js.src = "//connect.facebook.net/es_LA/all.js#xfbml=1&appId=287374454607456";
      fjs.parentNode.insertBefore(js, fjs);
      }(document, 'script', 'facebook-jssdk'));</script>
  

  #comments
    %ol.comments-list
      = nested_annotations @news.annotations.includes(:author).arrange(order: :created_at) 

  #comment-form
    %span.leave-a-comment
    %h3.form-title Deja un Comentario
    %span.meta.form-tagline Â¿Que opinas? Usa el formulario para hacernoslo saber.
    - if current_user  
      = render partial: 'annotations/form', locals: {annotable: @news, annotable_url: noticia_comentarios_path(@news)}
    - else
      Necesitas iniciar sesion para comentar
